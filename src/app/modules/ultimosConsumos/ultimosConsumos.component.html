<div class="ml-2 mr-2">
    <p-progressBar mode="indeterminate" [style]="{ height: '6px'}" *ngIf="progressBar"></p-progressBar>
</div>
<div class="grid grid-nogutter surface-0" style="border-radius: 10px; "> 
    <div class="pl-4 pt-2">
        <p class="text-xl font-bold" style="color: #0c475b;">> ÚLTIMOS CONSUMOS</p>
    </div>                       
    <div class="col-12 md:col-12" >
        <div class="">                                    
            <p-table #dtTarjetas [value]="tarjetas" dataKey="numeTarj" [rows]="10" selectionMode="single" [rowHover]="true" styleClass="p-datatable-gridlines" [paginator]="false" [globalFilterFields]="['numeTarj','sociedad', 'pateDocu', 'fechEntr']" responsiveLayout="scroll" [tableStyle]="{'min-width': '30rem'}" [scrollable]="true" scrollHeight="350px" (onRowSelect)="onRowSelect($event)">
                <ng-template pTemplate="caption">
                    <div class="grid col-12">                     
                        <div class="grid col-10 pt-5">                    
                            <div class="pr-2 pl-3">  
                                <button class="p-element p-ripple p-button p-component p-button-success" (click)="exportToExcel()"><span class="p-button-icon p-button-icon-left pi pi-file-excel" aria-hidden="true"></span><span class="p-button-label">Exportar a Excel</span></button>                                                        
                            </div>
                        </div>  
                        <div class="col-2">
                            <span class="p-input-icon-right ">
                                <i class="pi pi-search"></i>                                    
                                <input pInputText type="text" #filter (input)="onGlobalFilter(dtTarjetas, $event)"  style="width:max-content;" />                                        
                            </span> 
                        </div>
                    </div>  
                </ng-template>
                <ng-template pTemplate="header">                            
                    <tr>                                                           
                        <th pSortableColumn="numeTarj" style="min-width: 100px;" class="pl-2">N° DE TARJETA <p-sortIcon field="numeTarj"></p-sortIcon></th>
                        <th pSortableColumn="sociedad" style="min-width: 120px;">SOCIEDAD <p-sortIcon field="sociedad"></p-sortIcon></th>
                        <th pSortableColumn="pateDocu" style="min-width: 100px;">PATENTE / DNI <p-sortIcon field="pateDocu"></p-sortIcon></th>
                        <th pSortableColumn="fechEntr" style="min-width: 100px;">FECHA ENTREGA <p-sortIcon field="fechEntr"></p-sortIcon></th>                        
                        <th pSortableColumn="ultimoConsumo">ULT. CONSUMO<p-sortIcon field="utimoConsumo"></p-sortIcon></th>
                        <th pSortableColumn="diasSinConsumo" style="min-width: 80px;">DIAS SIN USO <p-sortIcon field="diasSinConsumo"></p-sortIcon></th>                                                                         
                        <th></th>
                    </tr>                                                                    
                </ng-template>                                     
                <ng-template pTemplate="body" let-tarjeta>
                    <tr [pSelectableRow]="tarjeta" class="p-0" >
                        <td class="pl-2">
                            {{tarjeta.numeTarj}}
                        </td>
                        <td>
                            {{tarjeta.sociedad}}
                        </td>
                        <td>
                            {{tarjeta.pateDocu}}
                        </td>
                        <td>
                            {{tarjeta.fechEntr | date: 'dd/MM/yyyy'}}
                        </td>
                        <td>
                            {{tarjeta.ultimoConsumo | date: 'dd/MM/yyyy'}}
                        </td>
                        <td>
                            {{tarjeta.diasSinConsumo}}
                        </td>    
                        <td class="text-left">
                            <button class="p-link layout-topbar-menu-button layout-topbar-button" (click)="verDetalle(tarjeta)">
                                <img src="./assets/gtc/images/administracionTarjetas-gray.svg" style="width: 1.5rem;">
                            </button>                                
                        </td>                                                                                            
                    </tr>
                </ng-template>                
            </p-table>        
            <div class="pl-2" style="color:#0c475b">Este listado muestro sólo las tarjetas que figuran activas.</div>            
        </div>        
    </div> 
    <!--
    <div *ngIf="!seleccionada" class="col-3 md:col-3 pl-3">                                                                 
        <div class="card surface-0">
            <p  class="pt-2 pl-2 text-sm mb-2 text-center font-bold" style="color:#093544;">HISTORIAL DE LA TARJETA</p>                                 
            <div class="text-center">
                <i class="pi pi-credit-card pi-creditcard" style="color:#093544; width: 100px;"></i>
            </div>             
            <p class="ml-2 text-sm font-bold text-center" style="font-style: italic; color:#76a4b8;"> NO SELECCIONADA</p>                                       
        </div>            
    </div>  
    <div *ngIf="seleccionada" class="col-12 pl-3">       
        <p  class="pt-1 pl-2 text-sm mb-2 font-bold" style="color:#093544;">HISTORIAL DE LA TARJETA SELECCIONADA</p>                                                                                           
        <div class="surface-0">
            <div class="grid col-12 p-0">
                <div class="col-2">                        
                    <div class="text-center">
                        <i class="pi pi-credit-card pi-creditcard" style="color:#093544; width: 100px;"></i>
                    </div>                      
                    <p class="ml-2 text-sm font-bold text-center" style="font-style: italic; color:#76a4b8;">{{numeroTarjeta}}</p>                                       
                </div>
                <div class="col-6 p-1">
                    <p-table [value]="tarjetaHistorico"  [rows]="5" styleClass="p-datatable-gridlines" responsiveLayout="scroll" [tableStyle]="{'max-width': '41.5rem'}" [scrollable]="true" scrollHeight="300px" >                        
                        <ng-template pTemplate="header">                            
                            <tr>                                    
                                <th style="width: 67px;">SOCIEDAD</th>
                                <th style="width: 25px;">CUENTA</th>                                   
                                <th style="width: 25px;">ENTREGA</th> 
                                <th style="width: 25px;">DEVOLUCIÓN</th>                                                             
                            </tr>                                                                    
                        </ng-template>                                     
                        <ng-template pTemplate="body" let-item>
                            <tr>                                
                                <td>
                                    {{item.sociedad}}
                                </td>
                                <td>
                                    {{item.numePres}}
                                </td>                                
                                <td>
                                    {{item.fechEntr}}
                                </td>
                                <td>
                                    {{item.fechDevo}}
                                </td>                                                                                                       
                            </tr>
                        </ng-template>
                    </p-table> 
                </div>               
                <div class="col-4 pl-5">
                    <button class="p-link layout-topbar-menu-button layout-topbar-button" (click)="verDetalle()" [disabled]="!this.seleccionada"><span class="p-button-label" style="color: #0c475b; font-weight: 600; font-style: italic;">Editar tarjeta en Administracion de Tarjetas</span></button>                            
                </div>                
            </div>
        </div>            
    </div> 
</div>    -->

<p-dialog [(visible)]="entregarDialog" header="Configuracion Guardada" [modal]="true" [style]="{width:'450px'}">
    <div class="flex align-items-center justify-content-center">
        <!--<span>La tarjeta <b><i>{{numeroTarjeta}}</i></b> ha sido creada correctamente.</span>-->
        <input type="date" [(ngModel)]="fechaEntrega">
    </div>
    <ng-template pTemplate="footer">        
        <button pButton pRipple icon="pi pi-check" class="p-button-text p-button-sm" label="Ok"  ></button>
    </ng-template>
</p-dialog>

